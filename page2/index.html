<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Triple Eh? &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/Boing.png">
  <link rel="shortcut icon" href="/public/Boing.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-09">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Triple Eh? Ltd.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Blog</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
	
		<span class="sidebar-nav-item">Follow me:</span>
		<a class="sidebar-nav-item" href="https://twitter.com/Triple_Eh_Ltd">- Twitter</a>
		<a class="sidebar-nav-item" href="https://www.youtube.com/channel/UC6H2Ql7vVE4hHc-GNkMK8bQ">- You Tube</a>
		<a class="sidebar-nav-item" href="https://www.twitch.tv/tripleeh">- Twitch</a>
		<span class="sidebar-nav-item">Games:</span>
		<a class="sidebar-nav-item" href="http://play-lumo.com/">- Lumo</a>
		<span class="sidebar-nav-item">Web:</span>
		<a class="sidebar-nav-item" href="http://triple-eh.com">- Triple Eh?</a>
		<span class="sidebar-nav-item">Feed:</span>
		<a class="sidebar-nav-item" href="https://triple-aye.net/atom.xml">- Atom Feed</a>
  	<a class="sidebar-nav-item" href="https://triple-aye.net/feed.json">- JSON Feed</a>
   </nav>


  <div class="sidebar-item">
    <p>
      &copy; 2018. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">
							<img style="border:none" src="/images/te_logo.png"/>
						</a>
            <small></small>
          </h3>
        </div>
      </div>
		

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://triple-aye.com//2018/05/26/A-new-look/">
        A new look...
      </a>
    </h1>

    <span class="post-date">26 May 2018</span>

    <p>So I’ve every so slightly updated the blog. There’s a new colour scheme and a fancy logo has appeared. Don’t worry, nothing’s really changed except I’ve finally decided 
to “brand” my one man company.</p>

<p>The new logo was made from a 99designs.com competition, which for me, worked out brilliantly; I got a new corporate logo and 
headers for all the various social media. For the designer, well, I’ve no idea how that’s a sustainable business given at 
least nine people competed for what amounted to a few hundred pounds worth of work. It seems like selling any creative work 
is an uphill struggle these days.</p>

<p>Anyway, the company website is now live and basically points you at the various other places where you can follow my work. You can check it out <a href="https://www.triple-eh.com">here.</a></p>

<p>I’m on holiday for the next week, but when I get back I’m going to look at doing the first video devlog. For now, enjoy the new colour scheme. :)</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://triple-aye.com//2018/05/05/I'm-alive/">
        I'm alive...
      </a>
    </h1>

    <span class="post-date">05 May 2018</span>

    <p>…with caveats :D</p>

<p>Apologies, things have been quiet on here, which wasn’t intentional.</p>

<p>At the start of April I suffered abdominal pains that, over the course of 6 hours, ended up with me 
having surgery for a suspected twisted intestine. I had the best possible outcomes from both the 
surgery and the recuperation, but it’s meant the better part of four weeks not doing much at all (“recuperating”, or “boredom” as I like to think of it).</p>

<p>I’m back on my feet, in fact, bar some much needed core strengthening to repair the muscle that was cut open 
I’d say I’m basically tip-top. Phew! So massive thanks to the Doctors and Nurses at Hki for their sterling work and humour. The physio was a bit harsh, though ;D</p>

<p>The next big change is that I’m moving back to the UK in June. Things are making their way into boxes, errands need to be run, 
and my eye is not really on my work. Again. But this shouldn’t take too long, or be too painful.</p>

<p>Once that’s out of the way I’m also thinking of doing more on Mixer/Twitch (and maybe You Tube), so my work is a little more visible. I love writing blog posts
but people don’t like reading them any more. That’s not to say this blog is going to die. It’s not. Some topics will deserve more detail than a video will allow so 
you can still expect updates here, I’ve just not made up my mind how frequently, or what sort of content will be best.</p>

<p>That’s a long winded way of apologising for the lack of updates this month, and for the lack of updates in the month to come. But I’ll be back soon :)</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://triple-aye.com//2018/03/24/Stylised-Water-Shader/">
        Stylised Water Shader
      </a>
    </h1>

    <span class="post-date">24 Mar 2018</span>

    <p><img src="/images/water.gif" alt="Water Animation Gif" /></p>

<p>Over the last few weeks I’ve been teaching 2nd year game programming students the basics of Unity3D shader programming. Last week 
this culminated in the class making a simple Surface Shader for water, which I’ve – shamelessly – tried to get close to Zelda: Wind Waker. Because.</p>

<p>Since stylised water effects are always in vogue, I figure this might be useful to other people.</p>

<p>I’ve exposed all the parameters, but it’s a stupidly simple shader that you should have no problem bending to your needs.</p>

<p>The GitHub repo is here: <a href="https://github.com/TripleEh/StylisedWater_SurfaceShader/">https://github.com/TripleEh/StylisedWater_SurfaceShader/</a></p>

<p>Enjoy!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://triple-aye.com//2018/03/07/In-Game-Sticky-Notes/">
        In-Game Sticky Notes...
      </a>
    </h1>

    <span class="post-date">07 Mar 2018</span>

    <p>You know what it’s like, you’re building something in-engine and you need to make a note of something — a TODO, or random idea — and your notepad isn’t to hand.</p>

<p>I went through a couple of notepads while making Lumo, as well as having a Remember The Milk list of TODOs and “wouldn’t it be funny ” ideas (most of which I actually managed to get through) but this requires a certain level of rigour. I had to constantly remind myself to go back and curate, lest I forget something. To this day I still have a niggling feeling that I let some good ideas slip…</p>

<p>I’ve been on the hunt for a better way of managing this, well, ever since I joined the industry, so I’ve tried various methodologies, mind-maps, Trello boards, Jira projects, and all the usual project management wank that, frankly, is just overkill for what is, essentially, a conversation with myself.</p>

<p>And then I remembered this:</p>

<p><img src="images/sticky1.jpg" alt="Screenshot of Nintendo's tooling in BotW" /></p>

<p>Fucking. Genius.</p>

<p>I’ve worked on projects with levels of automation before — screenshots in the bug database that embed camera co-ords (and/or other information) that you could double click to launch the build in the correct location — but Nintendo have gone to the logical extreme. They’ve integrated their project management processes directly into their game-world. And that’s lush. Perfect, in fact.</p>

<p>So how much of this would I need, working on my own?</p>

<p>Well, technically, not much. The first pass could literally be a sticky note. A gentle reminder, in-game, to do something, that I can edit and delete as I play-test. For this I’d only need:</p>

<ul>
  <li>A text entry box (that only appears in development builds)</li>
  <li>Mapped to some sort of joypad input (to show &amp; hide it)</li>
  <li>A way to save the current position, along with whatever text was entered</li>
  <li>Some modifications to the GameMode, to load this information and spawn Actors during start-up</li>
  <li>A way to delete notes</li>
  <li>I’d also like to keep this information human readable, just in case I want to review notes outside of the game</li>
</ul>

<h2 id="implementing">Implementing</h2>

<p>One of the mistakes I made with Lumo was relying on the Unity Inspector as the primary interface to the game’s state and “cheats”. This meant that I had to tick a bunch of boxes before letting the splash screen jump to the correct room, which became more than a little tedious by the end. One of the first things I did in LB was knock up a custom Dev UI to avoid this, so I already had the perfect place to add a text-entry box:</p>

<p><img src="images/sticky2.jpeg" alt="Screenshot of my dev UI" /></p>

<p>One pattern I’ve fallen into recently is using the Game Instance as my “Game Globals”. Rather than do a lot of GetX and casting — which is just as tedious in Blueprints as it is in code — I’ll store pointers to things I might need from several places in the Game Instance, or add simple Get/Set functions.</p>

<p>Storing the Note is an example of this. The Game Instance knows about the static functions that do the dirty work, and exposes a simple “Add” / “Remove” pair of methods to Blueprints.</p>

<p>[I tend to do most of my UI work in Blueprints now, primarily as they’re able to delay, which is handy when things are animating.]</p>

<p><img src="images/sticky3.png" alt="The Blueprint" /></p>

<h2 id="json">JSon</h2>

<p>Because I want the notes to be human readable, XML and Json immediately spring to mind. It seemed like a reasonable bet that one of these was implemented by UE4 and it turns out that Json is available by adding Json and JsonUtilities to your Build.cs file:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">new</span> <span class="n">string</span><span class="p">[]</span> <span class="p">{</span> <span class="p">...</span> <span class="s">"Json"</span><span class="p">,</span> <span class="s">"JsonUtilities"</span>  <span class="p">});</span>

</code></pre></div></div>

<p>There’s not a lot of documentation regarding Json, at least that I could find, but fortunately its use is scattered throughout the code-base. The simplest method that I’ve found looks like like this.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// Create a root JSon object that'll hold all the sub sections
</span><span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">FJsonObject</span><span class="o">&gt;</span> <span class="n">RootJson</span> <span class="o">=</span> <span class="n">MakeShareable</span><span class="p">(</span><span class="n">new</span> <span class="n">FJsonObject</span><span class="p">);</span>

<span class="c1">// Output the contents of the DevNotes arrays
</span><span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_aNoteContents</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
			<span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">FJsonObject</span><span class="o">&gt;</span> <span class="n">SubJson</span> <span class="o">=</span> <span class="n">MakeShareable</span><span class="p">(</span><span class="n">new</span> <span class="n">FJsonObject</span><span class="p">);</span>
			<span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">SetNumberField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"X"</span><span class="p">),</span> <span class="n">m_aNotePositions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">X</span><span class="p">);</span>
			<span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">SetNumberField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Y"</span><span class="p">),</span> <span class="n">m_aNotePositions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span><span class="p">);</span>
			<span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">SetNumberField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Z"</span><span class="p">),</span> <span class="n">m_aNotePositions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Z</span><span class="p">);</span>
			<span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">SetStringField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Note"</span><span class="p">),</span> <span class="o">*</span><span class="n">m_aNoteContents</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">RootJson</span><span class="o">-&gt;</span><span class="n">SetObjectField</span><span class="p">(</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Note_%d"</span><span class="p">),</span> <span class="n">i</span><span class="p">),</span> <span class="n">SubJson</span><span class="p">);</span>
	<span class="p">}</span>

<span class="p">}</span>

<span class="c1">// Output the built string to file
</span><span class="p">{</span>
	<span class="n">FString</span> <span class="n">OutputStr</span><span class="p">;</span>
	<span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">TJsonWriter</span><span class="o">&lt;&gt;&gt;</span> <span class="n">Writer</span> <span class="o">=</span> <span class="n">TJsonWriterFactory</span><span class="o">&lt;&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OutputStr</span><span class="p">);</span>
	<span class="n">FJsonSerializer</span><span class="o">::</span><span class="n">Serialize</span><span class="p">(</span><span class="n">RootJson</span><span class="p">,</span> <span class="n">Writer</span><span class="p">);</span>
	<span class="n">FString</span> <span class="n">sFullPath</span> <span class="o">=</span> <span class="n">FPaths</span><span class="o">::</span><span class="n">ProjectSavedDir</span><span class="p">()</span> <span class="o">+</span> <span class="n">_sDevNotesFilename</span><span class="p">;</span>
	<span class="n">FFileHelper</span><span class="o">::</span><span class="n">SaveStringToFile</span><span class="p">(</span><span class="n">OutputStr</span><span class="p">,</span> <span class="o">*</span><span class="n">sFullPath</span><span class="p">);</span>
<span class="p">}</span>


</code></pre></div></div>

<p>First we need to build the root of the Json document (RootJson) as this acts as the holder for the sub-objects that contain the actual data.</p>

<p>With that, we can then iterate over whatever data we wish to export. The Json format is just a collection of name-value pairs (Bool, String, Number…) which sit inside a pair of curly braces. Because of this, each note — which contains the position and text that I entered — needs to go in it’s own Json object, which is then added to RootJson.</p>

<p>Once we’ve parsed our data and built our Json we then need to serialise it out to a file, which we do by getting its string representation. This is achieved through TJsonWriter and FJsonSerializer. TJsonWriterFactory is templated to accept a printing policy when outputting to a string, but I’ve ignored that as the default is perfectly readable.</p>

<p>[You’ll note from the code example that I’m currently saving to the game’s “Save Game” directory. This may have to change in the future as the contents of this directory don’t get packaged up with the build. But the notes are just reminders to self…]</p>

<p>Loading the JSon is also dead simple, as it largely mirrors the creation process:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FString</span> <span class="n">sFullPath</span> <span class="o">=</span> <span class="n">FPaths</span><span class="o">::</span><span class="n">ProjectSavedDir</span><span class="p">()</span> <span class="o">+</span> <span class="n">_sDevNotesFilename</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">FPlatformFileManager</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetPlatformFile</span><span class="p">().</span><span class="n">FileExists</span><span class="p">(</span><span class="o">*</span><span class="n">sFullPath</span><span class="p">))</span>
<span class="p">{</span>
	<span class="n">UDbg</span><span class="o">::</span><span class="n">LOG_INFO</span><span class="p">(</span><span class="s">"UDevNote::Init: Found Dev Notes Json File"</span><span class="p">);</span>
	<span class="n">FString</span> <span class="n">FileString</span><span class="p">;</span>
	<span class="n">FFileHelper</span><span class="o">::</span><span class="n">LoadFileToString</span><span class="p">(</span><span class="n">FileString</span><span class="p">,</span> <span class="o">*</span><span class="n">sFullPath</span><span class="p">);</span>
				
	<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FJsonObject</span><span class="o">&gt;</span> <span class="n">RootJson</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">TJsonReader</span><span class="o">&lt;&gt;&gt;</span> <span class="n">JsonReader</span> <span class="o">=</span> <span class="n">TJsonReaderFactory</span><span class="o">&lt;&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">FileString</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">FJsonSerializer</span><span class="o">::</span><span class="n">Deserialize</span><span class="p">(</span><span class="n">JsonReader</span><span class="p">,</span> <span class="n">RootJson</span><span class="p">))</span>
	<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">const</span> <span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FJsonObject</span><span class="o">&gt;*</span> <span class="n">pObjectTest</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">RootJson</span><span class="o">-&gt;</span><span class="n">TryGetObjectField</span><span class="p">(</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Note_%d"</span><span class="p">),</span> <span class="n">i</span><span class="p">),</span><span class="n">pObjectTest</span><span class="p">))</span>
					<span class="k">break</span><span class="p">;</span>

				<span class="n">FJsonObject</span><span class="o">*</span> <span class="n">SubJson</span> <span class="o">=</span> <span class="n">pObjectTest</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">();</span>
				<span class="n">FVector</span> <span class="n">vPos</span> <span class="o">=</span> <span class="n">FVector</span><span class="p">(</span><span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">GetNumberField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"X"</span><span class="p">)),</span> <span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">GetNumberField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Y"</span><span class="p">)),</span> <span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">GetNumberField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Z"</span><span class="p">)));</span>
				<span class="n">FString</span> <span class="n">sNote</span> <span class="o">=</span> <span class="n">SubJson</span><span class="o">-&gt;</span><span class="n">GetStringField</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Note"</span><span class="p">));</span>
				<span class="n">m_aNoteContents</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">sNote</span><span class="p">);</span>
				<span class="n">m_aNotePositions</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">vPos</span><span class="p">);</span>
			<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<h2 id="game-framework-classes">Game Framework Classes</h2>

<p>Now that I have the ability to export notes from the UI (and reload them) I just need to be able to spawn a representation into the world. I’ve opted to create a DevNote actor class, and then add a pointer to the derived Blueprint instance to my Game Mode.</p>

<p>During BeginPlay() — in UE_BUILD_DEVELOPMENT configurations — the Game Mode checks that the Blueprint has been set, asks the Game Instance to check for Dev Notes, and then iterates over any, spawning an actor into the world for each.</p>

<p>This actor stores the text of the Dev Note so it can be passed to the dialog system.</p>

<p><img src="images/sticky4.png" alt="A Sticky Note" /></p>

<h2 id="viewing-dev-note">Viewing Dev Note</h2>

<p>The Dev Note acts in the same way as other interactables — things like sign posts, or NPCs that have a message to pass to the player — by flashing up a button to press when the player enters a trigger area.</p>

<p>If the player (me) interacts, the Dev Note text is passed to the dialog system, which pops up the appropriate UI.</p>

<p>I’ll maybe write-up the Dialog System in a later blog post.</p>

<p><img src="images/sticky5.png" alt="The Dialog System showing the note" /></p>

<h2 id="where-next">Where Next?</h2>

<p>I quite like this new toy so I’m already thinking of ways it could be more useful. Hooking it up to a Bug Database is an obvious thing to do, but I’d also like to be able to spit out QR codes that track the game’s state. With that I’d have a very handy tool that would completely eliminate the problem I faced with Lumo; jumping about the timeline and ensuring the game is in the correct state to replicate issues and do repeatable tests.</p>

<p>Anyway, it was a fun little aside, so maybe you’ll find it useful. :)</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://triple-aye.com//2018/01/20/Super-Simple-Day-Night-Cycle/">
        Super Simple Day Night Cycle
      </a>
    </h1>

    <span class="post-date">20 Jan 2018</span>

    <p>A Day/Night cycle can be a bit of a double edged sword. On the plus side it gives you the freedom to demarcate events into time periods — “they mostly come at night. Mostly…” — and on the downside you have to make the environment look good in a range of different lighting setups. So it’s important to have some easy controls.</p>

<p>I’ve flip-flopped on whether to include a day/night cycle in my new project for a while. I’m not at the point where the game is looking good in any setup, so making things harder from the start might not be the best decision. But, I do want to have night-time specific events, and having drowned myself in Breath Of The Wild over the last few months it’s clear that having a cycle, even if simple, does add to the sense of “place”. The player gets to see the world evolve, even in small ways, over time, and that’s good.</p>

<p>Before I begin explaining my simple implementation, let me point you at this series of videos from Kleiner Baer. He’s implemented an awesome Day/Night cycle that not only takes into account the long/lat of your game-world, but also the calendar seasons. I spent a day implementing it when I first considered adding Day/Night to my game, and it’s great, but not quite what I wanted…</p>

<p>So what does my system need to do?</p>

<ul>
  <li>I’ll need to be able to set the time of day, for obvious reasons.</li>
  <li>I’ll need to be able to get the time of day, as the Player will no doubt need it in a UI somewhere.</li>
  <li>I want control over the length of my shadows. This means doing more than a simple slow, continuous rotation of the Sun and Moon. I want short mid-day shadows, and longer shadows at dawn/dusk, that project at specific angles. I’m trying flatter the top-down view of the world.</li>
  <li>I don’t want black shadows, so I’m going to have to use a Sky Light to help lift them up, which means I’ll need to continuously update both the intensity of the Sky Light, and it’s colour.</li>
  <li>I’ll need the same control for the colour and intensity of the Sun and Moon…</li>
</ul>

<p>Because I’m a top down game I don’t need:</p>

<ul>
  <li>The Sun or Moon to be visible in the sky, or move across the sky correctly.</li>
</ul>

<p>This simplifies things.</p>

<p>My controller therefore needs: two directional lights (Sun and Moon), a Sky Light to help with the shadows, and a value to track the time.</p>

<p>The first thing to do is decide how to handle the time. I don’t want to be fiddling around with minutes / seconds — why do the maths when you can avoid it? — so given I only want hours I can track this with a single float, that works as a 24 hour clock:</p>

<ul>
  <li>0.9f == 9pm</li>
  <li>1.2f == Noon</li>
  <li>2.1f == 9pm</li>
</ul>

<p>Etc.</p>

<p>Updating the time is simple:</p>

<blockquote>
  <p>fCurrentGameTime += DeltaTime * (2.4f / fLengthOfDayInSeconds);</p>
</blockquote>

<p>which I can do in my DayNightController’s <em>Tick</em> function. Bob’s your mother’s brother.</p>

<p>(If I want minutes, say for the UI, I can get them by multiplying <em>fCurrentGameTime</em> by 10, and then pulling out the fractional part of the resulting float. This is the percentage of an “hour”, so:</p>

<blockquote>
  <p>(fFract*100.0f) * 0.59f</p>
</blockquote>

<p>will give me a screen-printable value, and I’ll just ignore seconds…)</p>

<p>So the main thing about this implementation is having control over colour and light intensity. I could just lerp between known-good values, say for morning, noon and night, but a far better way would be to use Curves.</p>

<p>UE4, handily, has an editable curve system for float, vector and colour values — exactly what’s needed here — and one of their big benefits is that you can edit them and see your changes reflected during PIE. This is perfect for me, as I’ll be fiddling with these curves until the day the game is released.</p>

<p>The Curve editor is fairly basic, but it does the job. For my system I need curves that go from 0.0 to 2.4f, which I pull-out using <em>fCurrentGameTime</em> as the index.</p>

<p><img src="/images/DN1.PNG" alt="Sun Colour" /></p>

<p>This is the curve for the colour of the Sun’s light during the course of the day. Atm I’m staying quite blue in the morning and blending to a very orange/red sunset in the evening, but this will be tweaked a million more times…</p>

<p>The angle of the sun’s light is done in a similar way:</p>

<p><img src="/images/DN2.png" alt="Angle9" /></p>

<p>Editing the Y value in this graph is what allows me to have very small shadows at mid-day and longer ones at dusk/dawn. Very tweakable.</p>

<p>So the class setup becomes:</p>

<p><img src="/images/DN3.png" alt="Class" /></p>

<p>And putting all this together, the Tick function looks like:</p>

<p><img src="/images/DN4.png" alt="Tick" /></p>

<p>As the title says: Super. Simple.</p>

<p>There’re a couple of gotchas with this, at least for me.</p>

<ul>
  <li>You need some sensible defaults, otherwise everything is going to be waaaay too bright when you drop a derived Blueprint into the world.</li>
  <li>Moveable Sky Lights will apply distance field AO by default, and that’s not something I’m after right now. It looks a little weird with my top-down view, but I may go back and tweak this later. Setting the Sky Light to Stationary disables this.</li>
  <li>Because my game is top-down I don’t need a sky box. Passing in a specific Cube map (all white) to the Sky Light makes it a little cheaper and gives better colour control. (Hat-tip to Mr Large for that factoid.)</li>
</ul>

<p>So you’ll want to setup some sane values in the constructor. You’ll probably want to play around with a couple of lights in the editor first and work out how you want the shadows to appear, as well. There’re a lot of settings to toy with depending on the look you’re after.</p>

<p>The end result, before I spend the next several years tweaking it, is pretty good.</p>

<p><img src="/images/DN5.gif" alt="TOD" /></p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
